" Misc settings
filetype plugin indent on
syntax on
set hidden
set backspace=indent,eol,start
set cursorline
set autoindent
set copyindent
set number
set shiftwidth=2
set shiftround
set showmatch
set ignorecase
set smartcase
set smarttab
set expandtab
set incsearch
set history=1000
set undolevels=1000
set wildignore=*.swp,*.bak
set visualbell
set noerrorbells
set nobackup
set noswapfile

" Map leader to <Space>
let mapleader = "\<Space>"

" Make the leader key not timeout
set notimeout
set ttimeout

" Map <C-g> to <esc> since it's used as keyboard-quit in spacemacs
noremap! <C-g> <Esc>

" Files
nnoremap <Leader>ff :e 
nnoremap <Leader>fs :w<CR>
nnoremap <Leader>fw :w<Space>

" Windows
nnoremap <Leader>wR <C-w><C-r>
nnoremap <Leader>wc <C-w>c
nnoremap <Leader>wh <C-w>h
nnoremap <Leader>wj <C-w>j
nnoremap <Leader>wk <C-w>k
nnoremap <Leader>wl <C-w>l
nnoremap <Leader>ws <C-w>s
nnoremap <Leader>wv <C-w>v

" Buffer
nnoremap <Leader>bb :ls<CR>:b
nnoremap <Leader>bc :ls<CR>:bd!
nnoremap <Leader>bk :b#<CR>:bd#<CR>
nnoremap <Leader>bn :bn<CR>
nnoremap <Leader>bp :bp<CR>

" Search
nnoremap <Leader>sa :call NewScratchBuffer('ack.vim')<CR>:r! ack 
nnoremap <Leader>pf :call NewScratchBuffer('find.vim')<CR>:r! find . -type f \| grep 
nnoremap <Leader>gd :call NewScratchBuffer('git.vim')<CR>:r! git diff<CR>gg
nnoremap <Leader>gh :call NewScratchBuffer('git.vim')<CR>:r! git diff --cached<CR>gg
nnoremap <Leader>gl :call NewScratchBuffer('git.vim')<CR>:r! git log -80<CR>gg
nnoremap <Leader>gs :call NewScratchBuffer('git.vim')<CR>:r! git status<CR>gg

" Quitting
nnoremap <Leader>qq :qa<CR>
nnoremap <Leader>qQ :qa!<CR>

" Utility functions for reading commands into a horizontal split
function MakeSplitBelow()
  split
  execute "normal \<C-w>j"
endfunction

" Change to and delete the contents of a buffer.
" If it doesn't exist, it creates one.
function ChangeTo(name)
  if bufexists(a:name)
    execute "buffer" a:name
    execute "normal ggdG"
  else
    enew
    execute "file" a:name
  endif
endfunction

function NewScratchBuffer(name)
  call MakeSplitBelow() " TODO Only make split if a buffer with 'name.vim' is not currently visible
  call ChangeTo(a:name)
  setlocal buftype=nofile
endfunction
